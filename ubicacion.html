<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti贸n de Ubicaciones - UTE</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1 data-i18n="title_ubicaciones">Gesti贸n de Ubicaciones</h1>
        <nav>
            <ul>
                <li><a href="index.html" data-i18n="nav_home">Inicio</a></li>
                <li><a href="eventos.html" data-i18n="nav_events">Eventos</a></li>
                <li><a href="contactos.html" data-i18n="nav_contacts">Contactos</a></li>
                <li><a href="ubicacion.html" data-i18n="nav_locations">Ubicaciones</a></li>
            </ul>
        </nav>

        <div style="text-align:center; margin-top: 1rem;">
            <button class="lang-btn" onclick="setLanguage('esp')"> Espa帽ol</button>
            <button class="lang-btn" onclick="setLanguage('eng')">吼 English</button>
        </div>
    </header>

    <main>
        <h2 data-i18n="add_location">Agregar Nueva Ubicaci贸n</h2>
        <form id="form-ubicaciones">
            <div>
                <label for="nombre_ubi" data-i18n="lbl_title">TTULO:</label>
                <input type="text" id="nombre_ubi" placeholder="Ej: Campus Principal" required>
            </div>
            <div>
                <label for="direccion" data-i18n="lbl_address">DIRECCIN:</label>
                <input type="text" id="direccion" required>
            </div>
            <div>
                <label for="coordenadas" data-i18n="lbl_coords">COORDENADAS GEOGRFICAS (LAT, LON):</label>
                <input type="text" id="coordenadas" placeholder="Ej: -0.1807, -78.4678" required>
            </div>
            <button type="submit" data-i18n="btn_save_loc">Guardar Ubicaci贸n en Firebase</button>
        </form>
        
        <hr>
        <h2 data-i18n="list_cloud_location">Ubicaciones Registradas (Nube)</h2>
        <ul id="lista-ubicaciones"></ul>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDxKQWalmHfLxhbYGru_hzvfuVCUJuHuzw",
            authDomain: "caso-practico-c631b.firebaseapp.com",
            projectId: "caso-practico-c631b",
            storageBucket: "caso-practico-c631b.firebasestorage.app",
            messagingSenderId: "233285378258",
            appId: "1:233285378258:web:8abcd2c3ae504e17da8d0b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.getElementById('form-ubicaciones').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await addDoc(collection(db, "ubicaciones"), {
                    nombre: document.getElementById('nombre_ubi').value,
                    direccion: document.getElementById('direccion').value,
                    coordenadas: document.getElementById('coordenadas').value,
                    createdAt: serverTimestamp()
                });
                alert("隆Ubicaci贸n Guardada!");
                location.reload();
            } catch (error) {
                alert("Error: " + error.message);
            }
        });

        const lista = document.getElementById('lista-ubicaciones');
        const q = query(collection(db, "ubicaciones"), orderBy("createdAt", "desc"));
        const querySnapshot = await getDocs(q);
        querySnapshot.forEach((doc) => {
            const item = doc.data();
            lista.innerHTML += `<li><strong>${item.nombre}</strong> - ${item.direccion} (${item.coordenadas})</li>`;
        });
    </script>

    <script>
        const I18N = {
            esp: {
                nav_home: "Inicio", nav_events: "Eventos", nav_contacts: "Contactos", nav_locations: "Ubicaciones",
                title_ubicaciones: "Gesti贸n de Ubicaciones",
                add_location: "Agregar Nueva Ubicaci贸n",
                lbl_title: "TTULO:",
                lbl_address: "DIRECCIN:",
                lbl_coords: "COORDENADAS GEOGRFICAS (LAT, LON):",
                btn_save_loc: "Guardar Ubicaci贸n en Firebase",
                list_cloud_location: "Ubicaciones Registradas (Nube)"
            },
            eng: {
                nav_home: "Home", nav_events: "Events", nav_contacts: "Contacts", nav_locations: "Locations",
                title_ubicaciones: "Location Management",
                add_location: "Add New Location",
                lbl_title: "TITLE:",
                lbl_address: "ADDRESS:",
                lbl_coords: "GEOGRAPHIC COORDINATES (LAT, LON):",
                btn_save_loc: "Save Location to Firebase",
                list_cloud_location: "Registered Locations (Cloud)"
            }
        };

        function setLanguage(lang) {
            localStorage.setItem('lang', lang);
            document.documentElement.lang = (lang === 'esp') ? 'es' : 'en';
            const texts = I18N[lang];

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (texts[key]) el.textContent = texts[key];
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('lang') || 'esp';
            setLanguage(savedLang);
        });
    </script>
</body>
</html>